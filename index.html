<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Riverside Discharge App – Sprint 1 Prototype</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg-body: #e9f2f5;
      --phone-bg: #ffffff;
      --accent: #31b373;
      --accent-soft: #e3f6ec;
      --accent-dark: #1b7b4d;
      --text-main: #123044;
      --text-muted: #7b8b99;
      --border-soft: #d3dde5;
      --danger: #f44336;
      --radius-phone: 34px;
      --radius-pill: 999px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      background: radial-gradient(circle at top, #f7fcff 0, #e0edf4 55%, #d1e2ee 100%);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-main);
    }

    .app-wrapper {
      padding: 24px 12px;
      width: 100%;
      display: flex;
      justify-content: center;
    }

    .phone-frame {
      width: 390px;
      max-width: 100%;
      height: 780px;
      background: linear-gradient(145deg, #fefefe, #f2f6fa);
      border-radius: var(--radius-phone);
      box-shadow: 0 28px 60px rgba(12, 42, 66, 0.35);
      padding: 12px;
      position: relative;
    }

    .phone-inner {
      background: var(--phone-bg);
      border-radius: 28px;
      height: 100%;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      border: 1px solid #e2ebf2;
    }

    .status-bar {
      height: 26px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 16px;
      font-size: 11px;
      color: var(--text-muted);
      border-bottom: 1px solid #edf2f6;
    }

    .status-center {
      width: 80px;
      height: 10px;
      border-radius: 8px;
      background: #e2e9ef;
      margin: 0 auto;
    }

    .app-header {
      padding: 10px 14px 8px;
      border-bottom: 1px solid #edf2f6;
    }

    .app-title-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 6px;
    }

    .app-title {
      font-size: 16px;
      font-weight: 600;
    }

    .app-subtitle {
      font-size: 11px;
      color: var(--text-muted);
    }

    .pill-nav {
      display: flex;
      gap: 6px;
      background: #f4f7fb;
      padding: 4px;
      border-radius: 999px;
    }

    .nav-pill {
      flex: 1;
      border-radius: 999px;
      border: none;
      background: transparent;
      font-size: 11px;
      padding: 5px 6px;
      cursor: pointer;
      color: var(--text-muted);
      transition: background 0.12s ease, color 0.12s ease, transform 0.07s ease;
      white-space: nowrap;
    }

    .nav-pill:hover {
      transform: translateY(-1px);
    }

    .nav-pill--active {
      background: #dff7e9;
      color: var(--accent-dark);
      font-weight: 600;
      box-shadow: 0 1px 4px rgba(8, 95, 54, 0.25);
    }

    .phone-main {
      flex: 1;
      padding: 14px 18px 16px;
      overflow-y: auto;
      background: radial-gradient(circle at top, #f9fcff 0, #ffffff 40%);
    }

    .screen {
      display: none;
      animation: fadeIn 0.15s ease-out;
    }
    .screen--active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(4px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .screen-title {
      font-size: 17px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .screen-caption {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 14px;
    }

    .input-group {
      margin-bottom: 10px;
    }

    .input-label {
      font-size: 11px;
      margin-bottom: 4px;
      color: var(--text-muted);
    }

    .input-field {
      width: 100%;
      border-radius: 10px;
      border: 1px solid var(--border-soft);
      padding: 8px 10px;
      font-size: 13px;
      outline: none;
      transition: border 0.12s ease, box-shadow 0.12s ease;
    }

    .input-field:focus {
      border-color: #9ddbc0;
      box-shadow: 0 0 0 1px #cef0dd;
    }

    .btn-main {
      width: 100%;
      border-radius: 12px;
      border: none;
      padding: 9px 12px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      background: linear-gradient(135deg, var(--accent), #43c789);
      color: #ffffff;
      box-shadow: 0 8px 18px rgba(22, 128, 77, 0.45);
      margin-top: 6px;
      margin-bottom: 6px;
      transition: transform 0.07s ease, box-shadow 0.07s ease, filter 0.07s ease;
    }

    .btn-main:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 22px rgba(22, 128, 77, 0.55);
      filter: brightness(1.03);
    }

    .btn-main--small {
      width: auto;
      padding-inline: 12px;
      font-size: 12px;
      margin-top: 0;
      margin-bottom: 0;
    }

    .btn-secondary {
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: #f6f8fb;
      color: var(--text-main);
      padding: 6px 10px;
      font-size: 11px;
      cursor: pointer;
      transition: background 0.12s ease, transform 0.07s ease;
    }

    .btn-secondary:hover {
      background: #edf3f8;
      transform: translateY(-1px);
    }

    .link-small {
      font-size: 11px;
      color: var(--accent-dark);
      text-align: center;
      margin-top: 4px;
      cursor: pointer;
    }

    .card-section {
      border-radius: 14px;
      border: 1px solid var(--border-soft);
      background: #f9fbfd;
      padding: 10px 10px 10px;
      margin-bottom: 10px;
    }

    .card-section-title {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 2px;
    }

    .card-section-text {
      font-size: 11px;
      color: var(--text-muted);
      margin-bottom: 6px;
    }

    .list-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 11px;
    }

    .list-table th {
      text-align: left;
      padding: 4px 2px;
      color: var(--text-muted);
      font-weight: 500;
      border-bottom: 1px solid #ecf0f4;
    }

    .list-table td {
      padding: 6px 2px;
      border-bottom: 1px solid #f1f4f7;
    }

    .row-clickable {
      cursor: pointer;
      transition: background 0.09s ease;
    }
    .row-clickable:hover {
      background: #f4fbf7;
    }

    .status-pill {
      display: inline-flex;
      align-items: center;
      border-radius: 999px;
      padding: 2px 7px;
      font-size: 10px;
      font-weight: 500;
    }

    .status-discharge { background: #fff7e1; color: #b88600; }
    .status-left      { background: #ffeae5; color: #c14b28; }
    .status-evs       { background: #e6f3ff; color: #2163c1; }
    .status-clean     { background: #e2f7eb; color: #1b7b4d; }

    .meta-row {
      display: flex;
      justify-content: space-between;
      font-size: 11px;
      margin-bottom: 6px;
      color: var(--text-muted);
    }

    .badge-outline {
      border-radius: 999px;
      padding: 2px 7px;
      border: 1px solid #dde5ee;
      font-size: 10px;
      color: var(--text-muted);
      background: #f7fafc;
    }

    .progress-dots {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 8px 0 10px;
    }

    .progress-step {
      flex: 1;
      text-align: center;
      font-size: 9px;
      color: var(--text-muted);
      position: relative;
    }

    .progress-dot {
      width: 9px;
      height: 9px;
      border-radius: 50%;
      border: 2px solid #d4dde6;
      margin: 0 auto 3px;
      background: #ffffff;
    }

    .progress-step::after {
      content: "";
      position: absolute;
      top: 4px;
      left: 50%;
      width: 100%;
      height: 1px;
      background: #dbe4ee;
      z-index: -1;
    }
    .progress-step:last-child::after {
      display: none;
    }

    .progress-step--done .progress-dot {
      border-color: var(--accent);
      background: var(--accent);
    }
    .progress-step--active .progress-dot {
      border-color: var(--accent-dark);
      background: #ffffff;
    }
    .progress-step--active {
      color: var(--accent-dark);
      font-weight: 600;
    }

    .event-log {
      width: 100%;
      border-collapse: collapse;
      font-size: 11px;
    }

    .event-log th {
      text-align: left;
      padding: 3px 2px;
      color: var(--text-muted);
      border-bottom: 1px solid #edf2f6;
      font-weight: 500;
    }

    .event-log td {
      padding: 4px 2px;
      border-bottom: 1px solid #f2f5f8;
    }

    .event-log tr:last-child td {
      border-bottom: none;
    }

    .section-label {
      font-size: 11px;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .evs-columns {
      display: grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap: 8px;
    }

    .evs-column {
      border-radius: 12px;
      border: 1px solid #e1e8f0;
      padding: 6px;
      background: #fafcfe;
    }

    .evs-column-title {
      font-size: 11px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .evs-card {
      border-radius: 10px;
      border: 1px solid #e1e8f0;
      padding: 6px;
      margin-bottom: 6px;
      background: #ffffff;
      font-size: 11px;
    }

    .evs-card-title {
      font-weight: 600;
      margin-bottom: 2px;
    }

    .evs-card-text {
      font-size: 10px;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .metric-row {
      display: flex;
      gap: 6px;
      margin-bottom: 6px;
    }

    .metric-tile {
      flex: 1;
      border-radius: 12px;
      border: 1px solid #e0e7f0;
      padding: 6px 7px;
      background: #f8fbff;
      font-size: 11px;
    }

    .metric-label {
      color: var(--text-muted);
      margin-bottom: 2px;
      font-size: 10px;
    }

    .metric-value {
      font-weight: 600;
      font-size: 13px;
    }

    .helper-text {
      font-size: 10px;
      color: var(--text-muted);
      margin-top: 4px;
    }
  </style>
</head>
<body>
  <div class="app-wrapper">
    <div class="phone-frame">
      <div class="phone-inner">
        <!-- Fake status bar -->
        <div class="status-bar">
          <span>09:31</span>
          <div class="status-center"></div>
          <span>LTE · 78%</span>
        </div>

        <!-- App header + nav pills -->
        <header class="app-header">
          <div class="app-title-row">
            <div>
              <div class="app-title">Riverside Discharge</div>
              <div class="app-subtitle">Pilot – 5B / 5C Units</div>
            </div>
          </div>
          <div class="pill-nav">
            <button class="nav-pill nav-pill--active" data-screen="home">Home</button>
            <button class="nav-pill" data-screen="queue">Queue</button>
            <button class="nav-pill" data-screen="evs">EVS Board</button>
            <button class="nav-pill" data-screen="bed">Bed Manager</button>
          </div>
        </header>

        <!-- Phone main content (screens swap here) -->
        <main class="phone-main">
          <!-- LOGIN -->
          <section id="screen-login" class="screen screen--active">
            <div class="screen-title">Login</div>
            <div class="screen-caption">
              Use your hospital network credentials to access the discharge tools.
            </div>

            <div class="input-group">
              <div class="input-label">Username</div>
              <input class="input-field" type="text" placeholder="e.g., rn.patel" />
            </div>
            <div class="input-group">
              <div class="input-label">Password</div>
              <input class="input-field" type="password" placeholder="••••••••" />
            </div>

            <button class="btn-main" onclick="handleLogin()">Login → Home</button>
            <div class="link-small">Forgot password?</div>
          </section>

          <!-- HOME -->
          <section id="screen-home" class="screen">
            <div class="screen-title">Home</div>
            <div class="screen-caption">
              Choose where you want to work: discharge queue, EVS cleaning tasks,
              or a live bed manager view.
            </div>

            <div class="card-section">
              <div class="card-section-title">Discharge Queue</div>
              <div class="card-section-text">
                View rooms moving from Discharge Ordered to Ready. Tap into a room
                to see details and mark the next step.
              </div>
              <button class="btn-main btn-main--small" onclick="showScreen('queue')">
                Open Discharge Queue
              </button>
            </div>

            <div class="card-section">
              <div class="card-section-title">EVS Board</div>
              <div class="card-section-text">
                EVS sees rooms waiting for clean versus in-progress, and can
                complete cleaning with a single tap.
              </div>
              <button class="btn-main btn-main--small" onclick="showScreen('evs')">
                Open EVS Board
              </button>
            </div>

            <div class="card-section">
              <div class="card-section-title">Bed Manager</div>
              <div class="card-section-text">
                Live occupancy and ready-room counts for admissions and transfers.
              </div>
              <button class="btn-main btn-main--small" onclick="showScreen('bed')">
                Open Bed Manager
              </button>
            </div>

            <div class="helper-text">
              Tip: you can also jump between screens using the tabs at the top
              of the phone.
            </div>
          </section>

          <!-- DISCHARGE QUEUE -->
          <section id="screen-queue" class="screen">
            <div class="screen-title">Discharge Queue</div>
            <div class="screen-caption">
              Rooms currently moving from Discharge Ordered → Patient Left → EVS
              → Ready. Tap a row to open room detail.
            </div>

            <div class="meta-row">
              <span class="badge-outline">Unit 5B / 5C</span>
              <span id="queue-count" class="badge-outline">0 rooms</span>
            </div>

            <table class="list-table">
              <thead>
                <tr>
                  <th>Room</th>
                  <th>Phase</th>
                  <th>Since</th>
                </tr>
              </thead>
              <tbody id="queue-body"></tbody>
            </table>

            <div class="helper-text">
              Tap a room to see status details, event log, and mark the next step.
            </div>
          </section>

          <!-- ROOM DETAIL -->
          <section id="screen-room" class="screen">
            <div id="room-detail-container"></div>
          </section>

          <!-- EVS BOARD -->
          <section id="screen-evs" class="screen">
            <div class="screen-title">EVS Task Board</div>
            <div class="screen-caption">
              EVS sees rooms waiting for cleaning (“To Do”) and rooms currently
              in progress. Use Accept and Complete to move tasks.
            </div>

            <div class="evs-columns">
              <div class="evs-column">
                <div class="evs-column-title">To Do</div>
                <div id="evs-todo"></div>
              </div>
              <div class="evs-column">
                <div class="evs-column-title">In Progress</div>
                <div id="evs-inprogress"></div>
              </div>
            </div>

            <div class="helper-text">
              Rooms that reach <strong>Room Clean</strong> drop off this board
              and become available in the Bed Manager view.
            </div>
          </section>

          <!-- BED MANAGER -->
          <section id="screen-bed" class="screen">
            <div class="screen-title">Bed Manager — Live</div>
            <div class="screen-caption">
              Snapshot of occupancy, rooms ready for assignment, and current
              discharge phases for the unit.
            </div>

            <div class="metric-row">
              <div class="metric-tile">
                <div class="metric-label">Occupancy</div>
                <div id="metric-occupancy" class="metric-value">–</div>
              </div>
              <div class="metric-tile">
                <div class="metric-label">Ready Rooms</div>
                <div id="metric-ready" class="metric-value">–</div>
              </div>
              <div class="metric-tile">
                <div class="metric-label">Waitlist</div>
                <div id="metric-wait" class="metric-value">5</div>
              </div>
            </div>

            <div class="section-label">Unit Snapshot</div>
            <div id="unit-snapshot" class="helper-text" style="margin-bottom:6px;"></div>

            <table class="list-table">
              <thead>
                <tr>
                  <th>Room</th>
                  <th>Status</th>
                  <th>Since</th>
                </tr>
              </thead>
              <tbody id="bed-body"></tbody>
            </table>
          </section>
        </main>
      </div>
    </div>
  </div>

  <script>
    // ---------- Data model ----------
    const patients = [
      {
        id: 1,
        room: "5B-312",
        unit: "5B",
        priority: "High – Isolation",
        statusHistory: [
          { status: "Discharge Ordered", at: minutesAgo(8) }
        ]
      },
      {
        id: 2,
        room: "5B-318",
        unit: "5B",
        priority: "Medium",
        statusHistory: [
          { status: "Patient Left", at: minutesAgo(3) }
        ]
      },
      {
        id: 3,
        room: "5B-220",
        unit: "5B",
        priority: "High – Deep clean",
        statusHistory: [
          { status: "EVS In Progress", at: minutesAgo(12) }
        ]
      },
      {
        id: 4,
        room: "5C-114",
        unit: "5C",
        priority: "Standard",
        statusHistory: [
          { status: "Room Clean", at: minutesAgo(5) }
        ]
      }
    ];

    const workflowOrder = [
      "Discharge Ordered",
      "Patient Left",
      "EVS In Progress",
      "Room Clean"
    ];

    let selectedPatientId = patients[0].id;
    let isLoggedIn = false;

    // ---------- Helpers ----------
    function minutesAgo(min) {
      return new Date(Date.now() - min * 60 * 1000);
    }

    function getCurrentStatus(patient) {
      const last = patient.statusHistory[patient.statusHistory.length - 1];
      return last.status;
    }

    function getCurrentStatusTime(patient) {
      const last = patient.statusHistory[patient.statusHistory.length - 1];
      return last.at;
    }

    function statusClass(status) {
      switch (status) {
        case "Discharge Ordered": return "status-discharge";
        case "Patient Left":      return "status-left";
        case "EVS In Progress":   return "status-evs";
        case "Room Clean":        return "status-clean";
        default:                  return "";
      }
    }

    function formatSince(date) {
      const diffMs = Date.now() - date.getTime();
      const diffMin = Math.floor(diffMs / 60000);
      if (diffMin < 1) return "Just now";
      if (diffMin < 60) return diffMin + " min";
      const hours = Math.floor(diffMin / 60);
      const mins = diffMin % 60;
      if (hours < 24) {
        return hours + " hr" + (hours > 1 ? "s" : "") + (mins ? " " + mins + " min" : "");
      }
      const days = Math.floor(hours / 24);
      return days + " day" + (days > 1 ? "s" : "");
    }

    function getNextStatus(current) {
      const idx = workflowOrder.indexOf(current);
      if (idx === -1 || idx === workflowOrder.length - 1) return null;
      return workflowOrder[idx + 1];
    }

    // ---------- Navigation / screens ----------
    function showScreen(name) {
      if (!isLoggedIn && name !== "login") {
        name = "login";
      }

      document.querySelectorAll(".screen").forEach(s => {
        s.classList.remove("screen--active");
      });
      const active = document.getElementById("screen-" + name);
      if (active) active.classList.add("screen--active");

      // nav pills: treat login as "home" tab visually
      document.querySelectorAll(".nav-pill").forEach(btn => {
        const target = btn.getAttribute("data-screen");
        const shouldActive = (name === "login" && target === "home") || target === name;
        btn.classList.toggle("nav-pill--active", shouldActive);
      });

      // refresh relevant views
      if (name === "queue") renderQueue();
      if (name === "room") renderRoomDetail();
      if (name === "evs") renderEVSBoard();
      if (name === "bed") renderBedManager();
      if (name === "home") renderBedManager(); // keep metrics somewhat fresh
    }

    function handleLogin() {
      isLoggedIn = true;
      showScreen("home");
    }

    window.showScreen = showScreen;
    window.handleLogin = handleLogin;

    function initNav() {
      document.querySelectorAll(".nav-pill").forEach(btn => {
        btn.addEventListener("click", () => {
          const target = btn.getAttribute("data-screen");
          showScreen(target);
        });
      });
    }

    // ---------- Render: Queue ----------
    function renderQueue() {
      const tbody = document.getElementById("queue-body");
      if (!tbody) return;
      tbody.innerHTML = "";

      patients.forEach(p => {
        const tr = document.createElement("tr");
        tr.classList.add("row-clickable");
        tr.addEventListener("click", () => openRoom(p.id));

        const roomTd = document.createElement("td");
        roomTd.textContent = p.room;

        const phaseTd = document.createElement("td");
        const pill = document.createElement("span");
        pill.className = "status-pill " + statusClass(getCurrentStatus(p));
        pill.textContent = getCurrentStatus(p);
        phaseTd.appendChild(pill);

        const sinceTd = document.createElement("td");
        sinceTd.textContent = formatSince(getCurrentStatusTime(p));

        tr.appendChild(roomTd);
        tr.appendChild(phaseTd);
        tr.appendChild(sinceTd);
        tbody.appendChild(tr);
      });

      const countEl = document.getElementById("queue-count");
      if (countEl) countEl.textContent = patients.length + " rooms";
    }

    function openRoom(id) {
      selectedPatientId = id;
      renderRoomDetail();
      showScreen("room");
    }

    // ---------- Render: Room detail ----------
    function renderRoomDetail() {
      const container = document.getElementById("room-detail-container");
      if (!container) return;

      const patient = patients.find(p => p.id === selectedPatientId);
      if (!patient) {
        container.innerHTML = "<div>Room not found.</div>";
        return;
      }

      const status = getCurrentStatus(patient);
      const since = formatSince(getCurrentStatusTime(patient));
      const nextStatus = getNextStatus(status);

      // progress dots
      const currentIndex = workflowOrder.indexOf(status);
      const progressHTML = `
        <div class="progress-dots">
          ${workflowOrder.map((step, i) => {
            const classes =
              i < currentIndex ? "progress-step progress-step--done" :
              i === currentIndex ? "progress-step progress-step--active" :
              "progress-step";
            return `
              <div class="${classes}">
                <div class="progress-dot"></div>
                <div>${step}</div>
              </div>
            `;
          }).join("")}
        </div>
      `;

      const logRows = patient.statusHistory.map(ev => {
        return `
          <tr>
            <td>${ev.at.toLocaleTimeString([], {hour: "2-digit", minute: "2-digit"})}</td>
            <td>${ev.status}</td>
            <td>System</td>
          </tr>
        `;
      }).join("");

      let nextBtnHTML = "";
      if (nextStatus) {
        let label;
        if (status === "Discharge Ordered") label = "Mark Patient Left";
        else if (status === "Patient Left") label = "Start EVS Clean";
        else if (status === "EVS In Progress") label = "Mark Room Clean";
        else label = "Next step";

        nextBtnHTML = `
          <button class="btn-main" onclick="advanceStatus()">
            ${label}
          </button>
        `;
      } else {
        nextBtnHTML = `<div class="helper-text">Room is already <strong>Room Clean</strong>. No further steps in this flow.</div>`;
      }

      container.innerHTML = `
        <div class="screen-title">Room ${patient.room}</div>
        <div class="screen-caption">
          Status, priority, and event history for this discharge room.
        </div>

        <div class="meta-row">
          <span class="badge-outline">${patient.unit} Unit</span>
          <span class="badge-outline">${patient.priority}</span>
        </div>

        <div class="meta-row">
          <span style="font-size:11px;">
            <strong>Status:</strong> <span class="status-pill ${statusClass(status)}">${status}</span>
          </span>
          <span style="font-size:11px; color:${'var(--text-muted)'};">Since ${since}</span>
        </div>

        ${progressHTML}

        ${nextBtnHTML}

        <div class="section-label" style="margin-top:10px;">Event Log</div>
        <table class="event-log">
          <thead>
            <tr>
              <th>Time</th>
              <th>Event</th>
              <th>User</th>
            </tr>
          </thead>
          <tbody>
            ${logRows}
          </tbody>
        </table>

        <div style="display:flex; gap:6px; margin-top:10px;">
          <button class="btn-secondary" onclick="showScreen('queue')">← Back to Queue</button>
          <button class="btn-secondary" onclick="showScreen('home')">Home</button>
        </div>
      `;
    }

    window.advanceStatus = function(id) {
      const targetId = id || selectedPatientId;
      const patient = patients.find(p => p.id === targetId);
      if (!patient) return;

      const current = getCurrentStatus(patient);
      const next = getNextStatus(current);
      if (!next) return;

      const confirmMsg = `Move room ${patient.room} from "${current}" to "${next}"?`;
      if (!window.confirm(confirmMsg)) return;

      patient.statusHistory.push({
        status: next,
        at: new Date()
      });

      // Re-render all dependent views
      renderQueue();
      renderRoomDetail();
      renderEVSBoard();
      renderBedManager();
    };

    // ---------- Render: EVS board ----------
    function renderEVSBoard() {
      const todoContainer = document.getElementById("evs-todo");
      const inprogContainer = document.getElementById("evs-inprogress");
      if (!todoContainer || !inprogContainer) return;

      todoContainer.innerHTML = "";
      inprogContainer.innerHTML = "";

      patients.forEach(p => {
        const status = getCurrentStatus(p);
        if (status === "Patient Left" || status === "EVS In Progress") {
          const card = document.createElement("div");
          card.className = "evs-card";
          card.innerHTML = `
            <div class="evs-card-title">${p.room}</div>
            <div class="evs-card-text">${p.priority}</div>
            <div class="evs-card-text">Phase: ${status} · ${formatSince(getCurrentStatusTime(p))}</div>
          `;

          const btn = document.createElement("button");
          btn.className = "btn-main btn-main--small";
          btn.style.width = "100%";

          if (status === "Patient Left") {
            btn.textContent = "Accept & Start Cleaning";
          } else if (status === "EVS In Progress") {
            btn.textContent = "Complete & Mark Room Clean";
          }

          btn.addEventListener("click", () => advanceStatus(p.id));
          card.appendChild(btn);

          if (status === "Patient Left") {
            todoContainer.appendChild(card);
          } else {
            inprogContainer.appendChild(card);
          }
        }
      });

      if (!todoContainer.innerHTML.trim()) {
        todoContainer.innerHTML = `<div class="helper-text">No rooms waiting for EVS.</div>`;
      }
      if (!inprogContainer.innerHTML.trim()) {
        inprogContainer.innerHTML = `<div class="helper-text">No rooms currently in progress.</div>`;
      }
    }

    // ---------- Render: Bed manager ----------
    function renderBedManager() {
      const body = document.getElementById("bed-body");
      if (!body) return;
      body.innerHTML = "";

      const totalRooms = patients.length;
      const readyRooms = patients.filter(p => getCurrentStatus(p) === "Room Clean").length;
      const occupied = totalRooms - readyRooms;
      const occupancyPercent = Math.round((occupied / totalRooms) * 100);

      const occEl = document.getElementById("metric-occupancy");
      const readyEl = document.getElementById("metric-ready");
      const waitEl = document.getElementById("metric-wait");
      if (occEl) occEl.textContent = occupancyPercent + "%";
      if (readyEl) readyEl.textContent = readyRooms.toString();
      if (waitEl && !waitEl.textContent) waitEl.textContent = "5";

      const snapshotEl = document.getElementById("unit-snapshot");
      if (snapshotEl) {
        snapshotEl.textContent =
          `${occupied}/${totalRooms} rooms occupied • ${readyRooms} ready for assignment`;
      }

      patients.forEach(p => {
        const tr = document.createElement("tr");

        const roomTd = document.createElement("td");
        roomTd.textContent = p.room;

        const statusTd = document.createElement("td");
        const pill = document.createElement("span");
        const status = getCurrentStatus(p);
        pill.className = "status-pill " + statusClass(status);
        pill.textContent = status;
        statusTd.appendChild(pill);

        const sinceTd = document.createElement("td");
        sinceTd.textContent = formatSince(getCurrentStatusTime(p));

        tr.appendChild(roomTd);
        tr.appendChild(statusTd);
        tr.appendChild(sinceTd);
        body.appendChild(tr);
      });
    }

    // ---------- Init ----------
    document.addEventListener("DOMContentLoaded", () => {
      initNav();
      renderQueue();
      renderEVSBoard();
      renderBedManager();
      renderRoomDetail();
      showScreen("login");
    });
  </script>
</body>
</html>
